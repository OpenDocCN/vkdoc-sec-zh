# 一、什么是渗透测试？

渗透测试是一门艺术。你可以学习很多技术，了解所有的工具，但现实是软件是复杂的，尤其是当你开始把很多软件系统放在一起的时候。正是这种复杂性意味着，在寻找进入系统的方法时，不存在放之四海而皆准的解决方案。对一台 Web 服务器有效的攻击可能对运行在不同系统上的同一台 Web 服务器无效。有时，在某个特定的攻击突然开始起作用之前，你可以尝试多次而不成功，然后你就找到了侵入系统的方法。一个熟练且成功的渗透测试人员不仅拥有运行工具和理解正在发生的事情所必需的技术技能，还拥有尝试不同方法所必需的创造力。

你可能会听到渗透测试被称为道德黑客。事实上，有一些专业认证的名称中包含了道德黑客。它们本质上是一样的，尽管道德黑客在名称中包含渗透测试没有的成分。道德是渗透测试的一个重要组成部分。毕竟，这个名字已经说明了一切。您正在测试是否可以穿透系统和网络防御。如果你能渗透进去，你就获得了某种程度的接触。在正常运营过程中，这可能是您可能没有的访问权限，这就是道德的用武之地，尽管在现实中，道德成分更多的是法律要求。

美国和许多其他国家的法律规定，未经授权访问计算机系统和网络是非法的。一旦你获得了渗透测试的权限，你就违反了法律。当然，除非你得到许可。虽然您可能没有相关系统的帐户，这是显式授权，但您应该始终拥有执行测试的权限，这是获得系统访问权限的隐式授权。这种许可是至关重要的，你可能有时会听到它被称为“出狱自由”卡。虽然从技术上来说，这更像是一张“远离监狱”的卡片，而不是一张“走出监狱”的卡片，但你不想忽视的一个词是“监狱”。如果你认为你在帮某人测试他们的网络或应用程序安全，并且当你发现一个严重的漏洞时他们会感谢你，那么请再想一想。即使在几年前，当每个人都不太担心计算机安全时，这也不是由受人尊敬的专业人士做的。执行任何类型的渗透测试或使用我们将要审查的工具来对付您不同意接触的系统，都有可能让您锒铛入狱。

闯入系统可以是有趣和令人兴奋的，有些人真的发现解决难题和进入有点高。然而，有很多方法可以在不测试其他人的系统的情况下获得经验。使用 VirtualBox、VMWare 或 Parallels 等虚拟机软件，您可以在一台计算机系统上安装多个操作系统。事实上，我强烈建议启动并运行一些虚拟机，这样您就可以尝试一些我们将介绍的技术。至少，您可能希望安装 Kali Linux 和 Metasploitable 2 的副本。Kali Linux 是一个曾经被称为回溯的 Linux 发行版。它包含了许多默认安装的安全工具，可以用来对发行版中的内容进行渗透测试。Metasploitable 2 是 Linux 的一个实现，它被设计成可利用的。它包括易受攻击的各种服务版本，可在漏洞框架 Metasploit 中获得。复制一个旧的 Windows 安装也不是一个坏主意，只是为了看看 Windows 攻击是什么样子的。

## 信息安全

为什么我们要进行渗透测试？最终，渗透测试人员的目标是帮助组织提高防御能力，以防真正的攻击者闯入并窃取信息。这种信息可以以多种形式出现。就企业而言，它可能是知识产权。这是企业赖以将其与其他公司区分开来的任何信息。这可能是专利、源代码或任何其他关于业务如何运行的文档。其他形式的数据包括银行信息、信用卡号、社会保险号、用户名、密码，尤其是任何与医疗保健相关的数据。攻击者可能试图窃取其中的任何信息，因为这些信息可能被出售或用于获得对其他系统的额外访问权限。

你会发现我几乎避免使用任何形式的 hack 这个词。黑客技术有着悠久而传奇的历史，比它在计算机上的应用早了几十年。当我开始使用电脑时，黑客意味着用电脑做一些非常酷和有趣的事情。黑客攻击的结果就是黑客攻击。这些天来，hack 和 hacking 显然是想暗示一些别的东西，但媒体使用这些词的方式非常模糊，它掩盖了真正发生的事情。在大多数情况下，当你在新闻中听到“黑客”时，你听到的是犯罪。我发现最好把犯罪叫做犯罪。如果我们谈论的是犯下这一罪行的人，我们谈论的是罪犯。为了清楚起见，你会看到攻击者或对手这两个词。这些人试图闯入你的系统。你会看到单词 attack 用来表示他们在做什么。重要的是要记住，这些人的所作所为一点也不可爱或迷人。他们经常有充足的资金和良好的组织，他们的活动是作为一种商业运作，因为他们从中赚了很多钱。对待他们就好像他们有武器，很危险，因为他们就是。

组织将花费大量时间和资源来保护自己免受这些攻击。他们将实现防火墙来阻挡攻击者，并实现入侵检测系统，以便在有人通过防火墙时有希望捕捉到。他们还将在组织内实现程序，以保护自己免受内部攻击，这种攻击也很常见。这可能包括对强密码或多因素身份验证的要求，这可能要求用户除了使用用户名和密码之外，还必须携带某些东西，甚至使用指纹之类的东西。

组织试图防范的是漏洞。漏洞是系统中的弱点。然而，系统是一个非常模糊的术语。在这种情况下，通过使用“系统”一词，我们不仅谈论使您的计算机有用的操作系统和应用程序，而且在更大的范围内，还谈论整个企业网络中的所有计算机和网络设备。组织将试图找到它的弱点或漏洞，并消除或减少它们。试图消除或减少漏洞的过程称为补救。当您试图降低被利用的漏洞的影响时，您就是在减轻影响。因此，在管理漏洞的过程中，您会听到缓解和补救这两个术语。

当你利用一个漏洞时，你就是在利用它。随着我们的继续，您将会看到对漏洞利用的引用，这些漏洞利用是特定的技术，甚至是旨在利用特定漏洞的软件。利用漏洞的目的可能是获得系统级访问权限，这意味着攻击者可以看到甚至控制文件、用户和服务。其中一些操作需要比普通用户更高的访问级别。在 Windows 系统上，你会说你有管理员权限。在 Linux 或类似 Unix 的系统下，你可以说你有根用户或超级用户权限。root 用户是类 Unix 系统(包括 Linux)上的默认管理帐户。如果您是 root 用户，您可以在系统上做任何事情。如果您是 root 用户，而有些操作您无法执行，那么可能是出了问题。

当我们谈论信息安全和漏洞管理时，最后要回顾的是概率和影响的概念。在评估漏洞时，安全专家通常会考虑两个因素。首先是概率。这通常会被定性为低、中或高。它指的是特定漏洞被利用的可能性。如果有可用的概念验证代码，或者如果有广泛可用的漏洞(“在野外”)，可能性可能非常高。如果您有额外的缓解措施，例如您必须在本地网络上而不是远程网络上才能利用该漏洞，您可能会认为这种可能性较低。进行这种评估和分类通常需要知识和经验的结合。

另一个需要了解的重要因素是影响。如果漏洞被触发，就会发生这种情况。如果利用漏洞导致应用程序崩溃，但它马上恢复，这可能是一个低影响的利用。另一方面，如果它导致远程攻击者对您的系统进行未经授权的管理访问，影响会很大。如果它导致对业务的关键或敏感信息的破坏，您也可以说它是高影响。虽然这可能比概率更容易衡量，但仍然需要大量的知识和经验才能做到准确。

为了让某人关注某个特定的漏洞，对影响和概率进行高评级可能很有诱惑力，但你很快就会失去可信度。没有必要绝对修复每个漏洞。确保最关键的问题得到最多的关注要重要得多。诚实并以事实为基础，你会确保你的意见有意义。

最后要注意的是。我们一直在谈论信息安全，这是一个你会经常听到的短语。目标是保护组织的信息资产。但是，攻击者可能不关心您的信息资产。他们可能更关心你的计算资产。换句话说，他们可能只是希望收集一个系统，并将其添加到为他们执行任务的系统网络中。这是一个非常有利可图的行业，所以不要因为你是一个小组织就认为你不是目标。你是。尤其是如果你很容易被选中的话。你的系统和它们的计算能力与那些知名大公司的一样好，如果它们很容易被侵入就更好了。

## 渗透测试的局限性

渗透测试是寻找漏洞并试图利用它们。但是，有些人和组织可能倾向于认为所有的漏洞都可以被快速利用。事实上，如果做得好，渗透测试可能是一个非常耗时的操作，为了执行测试，您通常只有非常有限的时间。如果组织正在寻找大爆炸，一个给你带来大量数据的大利用，那么一些害羞的东西可能会被视为他们是安全的迹象。事实上，没有什么比这更偏离事实了。

如果你或你工作的组织对目标缺乏远见，你将会以糟糕的结果告终，或者更糟的是，会给组织提供一个错误的安全感。如果你只发现小东西，你没有达到你的渗透目标。如果你没有渗透过任何系统，或者没有以任何显著的方式渗透过任何系统，这可能会被视为该系统或应用程序不能被渗透的标志。这意味着，在大量系统上花费时间的情况下，你无法穿透它。重要的是要记住，公司的对手是有动机的，并且通常在很长一段时间内是有耐心的。如果你是他们的目标，他们会在比你做渗透测试更长的时间内不断攻击你。

通常，渗透测试甚至在开始之前就可能因为实现的规则和约束而瘫痪。例如，我曾经参与过一些项目，其中客户不希望接触特定的系统和网络，因为他们知道这些系统和网络很脆弱。排除已知易受攻击的基础设施的测试不能完整或准确地表示组织的安全状况或它们有多易受攻击。如果在没有附加信息的情况下孤立地使用该报告，它会产生误导。

专注于渗透行为可能不会给你正在工作的公司带来很多好处。相反，执行安全评估可能更好。这在一定程度上是一种渗透测试，但它不仅限于您能够快速侵入的组件。您可能无法在有限的时间内找到问题。这并不意味着没有需要解决的问题。举个例子，虽然这是非常非常容易实现的，但我们经常看到 Web 服务器不仅提供软件名称，还提供版本。有时，甚至是 Linux 内核版本，如果它在 Linux 系统上的话。Windows 系统有时会提供运行 Internet Information Server (IIS)的 Windows 版本的详细信息。虽然这些可能不是可怕的问题，但它们为攻击者提供了太多的信息。当然，他们也许可以通过其他方式找到这些信息，但是为什么要让他们的工作变得更容易呢？让他们为得到的每一点信息而工作。当关闭一些泄漏点非常容易时，尤其如此。关闭从 Web 服务器公开版本号的功能只需要几分钟的时间。几乎没有理由不花几分钟来加强警戒。

如果您正在进行渗透测试，这种类型的发现不会得到很多分数。然而，安全评估完全是另一回事。安全评估的目的是尽可能真实完整地评估公司的安全状况。您可能会在安全评估中发现比渗透测试中多得多的项目。在渗透测试中，你可能不会与目标合作。如果目标在寻找支撑防御的方法，这通常是一个错误。是的，你可以测试操作响应能力，你可以感觉到一个人在没有任何内部帮助的情况下可以走多远，但是如上所述，这是一种错误的安全感。同样，发现某人在工作三天后无法进入并不能告诉你任何关于你对一个连续几周夜以继日工作的坚定攻击者的准备情况。

安全评估是安全专家和目标之间的合作。这通常是全知识渗透测试，以及渗透测试人员可能永远不会看到的配置和设置的审查。这是有价值的，原因有二。第一个是因为攻击者会不停地戳戳戳，直到某样东西最终屈服。第二，一些攻击发生在内部。这些人将了解其中一些设置，并能够利用它们。安全评估可以发现更有价值的信息，只需向第三方公开日常业务，第三方不会关注日常事务，对问题视而不见，因为“这就是这里的工作方式”执行安全评估的安全专业人员可以对所发现的问题进行客观分析，以便管理层确定问题的优先级并加以解决。

## 测试类型

第一种叫做黑盒测试。这有点像传统的渗透测试，但在极端的一端。黑盒测试意味着测试人员除了知道目标是谁之外，对目标一无所知。攻击者可能不知道 IP 地址、域名或任何东西。这需要事先收集大量情报。这可能是一个非常有价值的练习，因为一个公司应该总是知道他们向外部世界泄露了多少可以用来攻击他们的信息。信息收集将占用大量时间，因此确保为此安排时间非常重要。你不会想在分配给你的四天中抽出两天时间来收集信息，这样你就可以开始实现攻击了。

当有人正在执行全面的黑盒渗透测试时，这可能是测试响应能力的好机会。在这种情况下，你可能有一个红队，有时也被称为老虎队。红队是攻击队。他们是想进来的人。在内部的人，不管他们是否意识到它正在发生(有时操作人员不知道，以便获得真实的反应能力)，都被称为蓝队。你也可能有一个白人团队，他们知道这个等式的两端。这在比赛中更常见，然而，在这种情况下，白队完全是中立的，并管理比赛。

如果你有兴趣参与渗透测试的实践，并且你想以一种安全的方式完成它，这也是很有挑战性的，网上有很多比赛。这些有时被称为夺旗竞赛或网络防御竞赛。有时你在团队中工作，但也有挑战，你可以独自解决一个特殊的难题进入一个系统。

另一方面，更接近前面提到的安全评估的是白盒测试。这一般都是全知识。攻击小组与目标紧密合作。这可能需要提前建立凭证。这允许测试人员执行完整的本地(系统上)评估，而不必在检查本地设置之前进行渗透。你可能拥有外表看起来非常坚硬的系统，但是一旦系统破裂，它的内部就会变得柔软、黏糊糊。这可能是一个巨大的问题，所以检查本地强化和远程强化是有帮助的。运营团队通常会得到通知，并与攻击团队合作，以确保测试不会对客户造成影响。

在黑色盒子和白色盒子之间是灰色盒子。这是一个灰色地带，这听起来并不夸张。每个灰盒测试可能不同，因为它介于黑色和白色测试之间。一种常见的方法是预先提供所有的初始参数。这将是考虑使用的 IP 地址和主机名。这样，红队就不用花时间去搜寻这些信息了。这种方法还有一个好处，就是限制对明显超出范围的系统的影响，如果是真正的黑盒测试，这种情况可能会意外发生。考虑到这里可能发生的各种活动，让无辜的旁观者置身事外是很重要的。

理想情况下，确定你计划如何接近应该基于你所拥有的时间量和客户真正想要完成的事情的交集。你可以做的不同类型的测试总是有所取舍，所以你应该告诉客户或你的雇主在给你的时间内你可以做什么。如果他们担心一旦有人进入后会发生什么，白盒测试可能是最合适的。如果他们真的想了解他们对事故的反应，你可以使用黑盒测试。黑盒测试通常会在侦察上花费大量时间，而在实际测试上花费较少的时间。有时灰箱测试提供了最好的平衡，但这是你需要确保与客户沟通的事情。

通常，测试在生产环境中进行。这为实时系统中的防御措施提供了最佳思路。然而，这是有风险的。一些公司可能更喜欢在受保护的实验室环境中进行一些测试，以避免对实时系统造成任何影响。这样做可能是为了确保企业能够继续获得客户，但如果担心测试结果会导致数据损坏或泄露，也可以这样做。根据具体情况，这两种情况都是有效的，但您必须确保实验室环境尽可能真实地反映真实环境，否则一开始就进行测试就是浪费。

## 谁做钢笔测试

这确实是一个棘手的问题，你可以从几个不同的角度来探讨它。首先，你可能想知道从事这项工作的是什么类型的人。这可能归结于他们所拥有的知识或技能的类型。仅仅因为你是安全专家并不意味着你会是一个好的渗透测试者。如果你是一名防火墙管理员，从技术上讲，你应该是一名安全专家，但是你可能不擅长做渗透测试工作。这并不意味着你不擅长，但这两者并不自动携手并进。

就我个人而言，我认为它与技术技能关系不大，因为这些技能总是可以被教授或获得的。擅长渗透测试的人很可能是非常好奇的人。这是一个不允许事物停留在表面价值的人。作为其中的一部分，他们也将是持久的。他们希望对某件事有更多的了解，并持续关注某个特定的问题或挑战，直到他们解决了它或用尽了所有的可能性。渗透测试人员还需要一定的创造力。这是因为你需要一个能从不同角度解决问题的人，而不是第一次尝试就止步不前。

如果你想从内部找人替你做测试，解决这个问题是很重要的。这就带来了一个重要的问题:是使用组织内部的人还是外部的人。如果你使用外部组织，你会得到客观性的好处。外面的人不知道事情的运作方式，所以他们可能不会做出假设。每当执行渗透测试的人开始做假设时，他们就冒着遗漏许多漏洞的风险。如果你继续一次又一次地使用同一个外部测试器，同样的情况也会发生。结果就是太熟悉了。举个例子，几年前我有一个客户。在早期的一些测试过程中，我在做一些非常基本的扫描时无意中导致了一个系统失败。这个系统显然比我们任何人想象的都要脆弱得多，但那次经历最终影响了接下来几年的许多后续测试。我们总是很小心自己的攻击性。这包括外部团队和内部团队。

然而，使用内部人员意味着无论何时你需要他们，理论上你都有可以支配的人，并且你可以做大量的增量测试。然而，和其他事情一样，这也有优点和缺点。如果你对某件事看得太多，你可能会错过一个改变，因为你开始假设太多。此外，除非你可以付钱给那些唯一目的是执行这种测试的人，否则如果你经常使用他们来进行渗透测试，你就会失去那些可能有其他事情要做的人的生产力。

在找人执行渗透测试方面，有很多事情要考虑。如果你自己也想成为一名渗透测试员，考虑到你正在阅读的内容，准备花一些时间学习基本的渗透测试实践，以及如何构建复杂的 IT 系统，包括编程语言、数据库和系统管理。这些都会帮助你成为一个更好的渗透测试者，更深刻地理解你在做什么。这会让你更吃香。你的工具包越大，越多的人会想利用你。

## 方法学

在执行安全性测试时，有许多方法可用。你可以去找一个你喜欢的，无论是深度的还是非常简单的。你可以发展你自己的，一旦你开始掌握你正在做的事情，你可能就想这么做。出于我们的目的，我们将使用一个非常简化的框架。当你开始做你自己的渗透测试时，无论你使用什么方法学`—`并且你将需要使用某种方法学`—`你将想要与你的客户或雇主交流那种方法学。

使用方法的原因是为了证明你所做的是可重复的。你不只是在黑暗中开枪。你真的想通了你在做什么。提供你的方法论，在一个高层次上，表明你正在使用一个文档化的过程，即使你在每一个单独的时刻都是凭感觉飞行。提供方法通常会给你的测试和结论更多的权重。如果我只是提供一堆结论，而他们不知道我是如何得出这些结论的，整个事情可能更难接受。就像你在上数学课一样。展示你的作品。

我们将在本书中使用的方法是我在与客户合作时使用的常用方法的修改版本。它将允许我们直接进入渗透测试的核心部分。也就是说，这种方法有所简化。随着您继续工作，将会出现许多我们不会涉及的领域，包括以下内容:

1.  情报收集——这是针对你的目标的侦察工作，根据交战前你获得的信息多少而有所不同。即使向您提供了整个范围，您也可能想要执行一些侦察，以便您可以向客户提供从信息泄漏角度来看他们暴露程度的指导。
2.  扫描——这是不同层次的侦察。在你开始决定你的攻击策略之前，你需要知道你的目标是什么。这将为您提供大量关于系统和端口的信息，以及可能存在的任何防火墙的信息。这也是您可能需要小心的地方，这取决于您正在执行的测试级别。这可能是一个非常嘈杂的步骤，因为你在这里开始与目标直接接触。这可能对客户有用，看看他们是否能检测到扫描作为支撑他们防御姿态的一部分。
3.  漏洞识别–一旦您确定了一些目标系统和应用程序，获得已知漏洞的列表将告诉您可以快速轻松地进入哪些地方。您可以使用多种技术来执行此步骤。其中一些可能是自动化的，但其他的将非常手动。
4.  利用——您发现的漏洞会导致您被利用。这是您通过利用您发现的漏洞实际上开始渗透系统的地方。这一步可能非常耗时，也令人心碎，因为漏洞并不总是导致系统受损。一些漏洞很难被利用，而另一些漏洞可能无法利用。在这一阶段，您可能会发现许多误报，漏洞被识别出来，但预期的利用并没有起作用。
5.  报告——一旦你完成了，一定要清楚地记录下你的所有发现，这样你就有一些具体的、连贯的东西可以呈现给你的雇主或客户。这个阶段是必不可少的。尽管做前四步很有趣，但是如果你没有做好这一步，你就不会再被邀请去玩了，而且消息可能最终会传开，这样就没有人会邀请你去玩他们的玩具了。花时间学习写一份好的有效的报告。

实际上，这些阶段中的一些可能会被压缩，这取决于你工作的时间。您可能会发现使用的一些自动化工具可以在一个步骤中完成大部分工作。然而，不要依赖自动化工具。永远要仔细检查你的结果，不要假设他们总能找到漏洞，或者他们找到的漏洞总能被利用。这就是为什么分开做所有这些工作总是一个好主意，即使你有一个工具可以同时做一堆事情。事实是，虽然各种方法被设计来模拟攻击者的行为，但攻击者并不总是遵循这些步骤。他们可能只是简单地进行端口扫描或端口清扫，然后在发现可能易受攻击的开放端口后发起攻击。绝大多数情况下，盲目发动攻击几乎是没有成本的。

## 摘要

任何人都可以成为渗透测试员。好的渗透测试人员需要经验和知识，就像擅长其他职业的人一样。尽管渗透测试是一种高度技术性的职业，但它也是一门艺术。这是因为某一天有效的东西第二天可能就无效了。软件是复杂的。能够处理每天的差异并适应这些差异是工作的重要部分，也是使其成为一门艺术的重要部分。在每一次渗透测试中，从来没有一个清晰的分步过程。你必须有点创造力，非常坚持，非常有弹性。耐心和坚持会让你走向成功。

当你准备成为一名渗透测试员时，你应该牢记期望的道德义务。如果你只是想走出去，闯入系统而不考虑法律，你当然可以这样做。但这并不意味着你就是渗透测试者。这会让你成为一名罪犯，而且你很有可能再也不会自由了。总是，总是从你的目标那里得到关于你应该做什么的完全一致的意见。在你学习的过程中，要么找一个非常理解和宽容的人或组织，让你在他们的系统上尝试一些东西，或者，更好的是，给你自己找一个你可以使用的小型实验室系统。有许多方法可以做到这一点。最便宜的方法是获得一个内存很大的系统，然后构建虚拟机。这个不一定很贵。几乎任何一台现代电脑都能满足你的需求。然后你可以得到像 VirtualBox 这样的免费软件来托管你的虚拟机。

当您开始进入渗透测试时，请注意您正在遵循的步骤。当你习惯于遵循一个相当有规律的程序时，你就发展了你的方法。记录下来可能会有帮助。您可能希望在为您的雇主或客户生成的报告中使用您生成的文档。教育你的客户会改善你和他们的关系，让他们物有所值，并且清楚地展示你的价值。许多渗透测试人员提交的报告强调了他们能够做的一切，却没有清楚地解释发生了什么或者可以做些什么。提供清晰完整的文档也将确立你正在遵循一个过程，而不是对你正在做的每件事都信口开河。

## 练习

1.  如果您对 VirtualBox、VMWare 或 Parallels 更熟悉，可以购买它们的副本。在您的系统上安装它。您可以从 [`http://www.virtualbox.org`](http://www.virtualbox.org) 获得 VirtualBox。这将是一个简单的安装，除了接受任何提示的默认值之外，您不需要做任何事情。
2.  获取 Kali Linux 的副本。这将是一个。将用于将 Kali 安装到虚拟机中的 ISO 映像。您可以下载当前的。ISO 出自 [`http://www.kali.org`](http://www.kali.org) 。VirtualBox 将允许您从安装新的操作系统。您下载的 ISO 映像。同样，Kali 的安装应该相当简单。接受安装中的缺省值，因为缺省的 Kali 安装将使您达到我们的目的。
3.  获取 Metasploitable 2 的副本。有不同的地方可以得到这个。你应该使用谷歌、必应或者你最喜欢的搜索工具来寻找下载它的地方。这将是我们将要做的一些事情的一个很好的目标。这不需要安装。这是一个 VMWare 映像，您应该能够在任何虚拟化软件中打开它，包括 VirtualBox。